generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id          String     @id @default(uuid())
  email       String     @unique
  password    String
  role        Role       @default(MAHASISWA)
  student     Student?
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
}

model Student {
  id                      String             @id @default(uuid())
  nim                     String             @unique
  name                    String
  email                   String?
  study_program           String?
  user_id                 String?            @unique
  user                    User?              @relation(fields: [user_id], references: [id])
  thesis_submission       Thesis_submission[]

  created_at              DateTime           @default(now())
  updated_at              DateTime           @updatedAt
}

model Thesis_submission {
  id                String            @id @default(uuid())
  student_id        String
  thesis_title      String
  file_url          String
  status            Submission_status @default(MENUNGGU)
  reason_rejected   String?
  created_at        DateTime          @default(now())
  updated_at        DateTime          @updatedAt
  student           Student           @relation(fields: [student_id], references: [id])
  thesis_schedule   Thesis_schedule?

  @@index([student_id]) //search_fitur(soon)
}

model Thesis_schedule {
  id                String                @id @default(uuid())
  submission_id     String                @unique
  date              DateTime
  time              String
  examiner_1_id     String
  examiner_2_id     String
  created_at        DateTime              @default(now())
  updated_at        DateTime              @updatedAt
  submission        Thesis_submission     @relation(fields: [submission_id], references: [id])
  examiner_1        Examiner              @relation("examiner_1", fields: [examiner_1_id], references: [id])
  examiner_2        Examiner              @relation("examiner_2", fields: [examiner_2_id], references: [id])

  @@index([submission_id]) //search_fitur(soon)
  @@index([examiner_1_id]) //search_fitur(soon)
  @@index([examiner_2_id]) //search_fitur(soon)
}

model Examiner {
  id                      String            @id @default(uuid())
  name                    String
  email                   String?
  created_at              DateTime          @default(now())
  updated_at              DateTime          @updatedAt
  schedule_as_examiner_1  Thesis_schedule[] @relation("examiner_1")
  schedule_as_examiner_2  Thesis_schedule[] @relation("examiner_2")
}

enum Submission_status {
  MENUNGGU
  DISETUJUI
  DITOLAK
}

enum Role {
  ADMIN
  MAHASISWA
}
